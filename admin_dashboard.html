<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warden Admin Dashboard - HostelEase</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>HostelEase</h2>
                <span class="badge badge-high">ADMIN</span>
            </div>
            <div class="user-info">
                <p><strong>Welcome, Warden Admin</strong></p>
                <p>Warden Panel</p>
            </div>
            <ul class="sidebar-menu">
                <li class="menu-item"><a href="#overview" class="menu-link active">Overview</a></li>
                <li class="menu-item"><a href="#complaints" class="menu-link">Manage Complaints</a></li>
                <li class="menu-item"><a href="login.html" class="menu-link" style="color: var(--danger);">Logout</a>
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h1>Admin Dashboard</h1>
            </div>

            <!-- Stats Overview -->
            <section id="overview" class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">42</div>
                    <div class="stat-label">Total Complaints</div>
                </div>
                <div class="stat-card" style="border-left-color: var(--warning);">
                    <div class="stat-value">5</div>
                    <div class="stat-label">Pending / Submitted</div>
                </div>
                <div class="stat-card" style="border-left-color: var(--success);">
                    <div class="stat-value">37</div>
                    <div class="stat-label">Resolved / Closed</div>
                </div>
            </section>

            <!-- Complaints Management -->
            <section id="complaints" class="card">
                <h3>All Complaints (Priority View)</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Priority</th>
                                <th>Student</th>
                                <th>Room</th>
                                <th>Complaint</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Assigned To</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Complaints loaded from LocalStorage -->
                        </tbody>
                    </table>
                </div>
            </section>
        </div>
    </div>
    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const complaints = JSON.parse(localStorage.getItem('hostel_complaints')) || [];
            const tbody = document.querySelector('tbody');

            if (complaints.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align:center; padding: 2rem; color: #6b7280;">No complaints found. Submit one from the Student Dashboard!</td></tr>';
            } else {
                tbody.innerHTML = ''; // Clear loading/placeholder
                complaints.slice().reverse().forEach(c => { // Show newest first
                    const row = document.createElement('tr');

                    // Determine Button State
                    let actionBtn = '';
                    if (c.status === 'Submitted') {
                        actionBtn = `<button class="btn assign-btn" onclick="handleAssign(this, ${c.id})" style="padding: 0.25rem 0.5rem; width: auto; font-size: 0.8rem;">Assign</button>`;
                    } else {
                        actionBtn = `<button class="btn" style="padding: 0.25rem 0.5rem; width: auto; font-size: 0.8rem; background: #ccc; cursor: default;" disabled>Done</button>`;
                    }

                    let assignedTo = c.status === 'Submitted' ? '<span style="color:#9ca3af;">--</span>' : 'Staff Member';

                    // Priority Badge Color
                    let badgeClass = c.priority === 'High' ? 'badge-high' : (c.priority === 'Medium' ? 'badge-medium' : 'badge-low');

                    row.innerHTML = `
                        <td><span class="badge ${badgeClass}">${c.priority}</span></td>
                        <td>${c.student}<div style="font-size: 0.75rem; color: #6b7280;">ID: ${c.id}</div></td>
                        <td>${c.room}</td>
                        <td><strong>${c.title}</strong><br><span style="font-size: 0.85rem; color: #4b5563;">${c.category}</span></td>
                        <td>${c.date}</td>
                        <td><span class="badge status-${c.status.toLowerCase()}">${c.status}</span></td>
                        <td>${assignedTo}</td>
                        <td>${actionBtn}</td>
                     `;
                    tbody.appendChild(row);
                });
            }
        });

        // Global function for Assign button
        window.handleAssign = function (btn, id) {
            const row = btn.closest('tr');
            // Update UI
            row.cells[5].innerHTML = '<span class="badge status-assigned">Assigned</span>';
            row.cells[6].textContent = 'Staff Member';
            btn.textContent = 'Done';
            btn.disabled = true;
            btn.style.background = '#ccc';
            btn.style.cursor = 'default';

            // Update LocalStorage
            let complaints = JSON.parse(localStorage.getItem('hostel_complaints')) || [];
            const index = complaints.findIndex(x => x.id === id);
            if (index !== -1) {
                complaints[index].status = 'Assigned';
                localStorage.setItem('hostel_complaints', JSON.stringify(complaints));
            }
        }
    </script>
</body>

</html>